<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Administrador</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #1b4965;
        color: white;
      }

      h1 {
        text-align: center;
        font-size: 36px;
        margin: 20px 0;
      }

      .search-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .search-bar input {
        flex: 1;
        padding: 6px 10px;
        font-size: 14px;
        background-color: #3e4c59;
        color: white;
        border: none;
        border-radius: 4px;
        font-weight: bold;
      }

      .search-bar input::placeholder {
        color: #ddd;
      }

      .search-bar button {
        background-color: #3e4c59;
        color: white;
        font-weight: bold;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
      }

      .search-bar button:hover {
        background-color: #566372;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background-color: #3e4c59;
        color: white;
        font-size: 12px;
        margin-bottom: 20px;
        table-layout: fixed;
        word-wrap: break-word;
      }

      table th,
      table td {
        border: 6px solid #2c3948;
        padding: 5px;
        text-align: center;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      table th {
        background-color: #2c3948;
        font-weight: bold;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      .actions button {
        background-color: #3e4c59;
        color: white;
        font-weight: bold;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .actions button:hover {
        background-color: #566372;
      }

      #card-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .vaga-card {
        background: #fff;
        color: #000;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
      }

      .vaga-card h5 {
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: bold;
      }

      .vaga-card p {
        margin: 5px 0;
      }

      .btn-fechar {
        background: #3e4c59;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 15px;
      }

      .btn-fechar:hover {
        background: #566372;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Administrador</h1>

      <div class="search-bar">
        <input
          type="text"
          id="pesquisa_txt"
          placeholder="Pesquise por currículos ou vagas"
        />
        <button id="btn_pesquisa">Pesquisar</button>
      </div>

      <h4>Currículos Disponíveis</h4>
      <table>
        <thead>
          <tr>
            <th>Id</th>
            <th>Nome</th>
            <th>Descrição</th>
            <th>Contato</th>
            <th>Tipo</th>
            <th>Curso</th>
            <th>Nível</th>
          </tr>
        </thead>
        <tbody id="curriculodisponiveis_table"></tbody>
      </table>

      <h4>Vagas Disponíveis</h4>
      <table>
        <thead>
          <tr>
            <th>Id</th>
            <th>Empresa</th>
            <th>Descrição</th>
            <th>Contato</th>
            <th>Tipo</th>
            <th>Curso</th>
            <th>Nível</th>
          </tr>
        </thead>
        <tbody id="empresadisponiveis_table"></tbody>
      </table>

      <div class="actions">
        <button onclick="abrirTela('teladecadastro.html')">Criar Perfil</button>
        <button onclick="abrirTela('vagas.html')">Cadastrar Vaga</button>
        <button onclick="abrirTela('cadastroempresa.html')">
          Cadastrar Empresa
        </button>
        <button onclick="abrirTela('empresascadastradas.html')">
          Visualizar Empresas
        </button>
        <button onclick="abrirTela('novasenha2.html')">Redefinir Senha</button>
        <button onclick="abrirTela('configuracao2.html')">Configurações</button>
      </div>
    </div>

    <div id="card-overlay"></div>

    <script>
      function abrirTela(url) {
        window.location.href = url;
      }

      document.addEventListener("DOMContentLoaded", () => {
        carregarCurriculos();
        carregarVagas();

        document
          .getElementById("btn_pesquisa")
          .addEventListener("click", () => {
            const termo = document
              .getElementById("pesquisa_txt")
              .value.toLowerCase();
            carregarCurriculos(termo);
            carregarVagas(termo);
          });

        const overlay = document.getElementById("card-overlay");
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) fecharCard();
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") fecharCard();
        });
      });

      async function carregarCurriculos(filtro = "") {
        const url = "http://localhost:8080/api/curriculos";
        const response = await fetch(url);
        const data = await response.json();
        const tabela = document.getElementById("curriculodisponiveis_table");
        tabela.innerHTML = "";

        const curriculosFiltrados = filtro
          ? data.filter((c) =>
              Object.values(c).some(
                (val) => val && val.toString().toLowerCase().includes(filtro)
              )
            )
          : data;

        if (curriculosFiltrados.length === 0) {
          tabela.innerHTML = `<tr><td colspan="7" style="text-align:center">Nenhum currículo encontrado</td></tr>`;
          return;
        }

        curriculosFiltrados.forEach((c) => {
          const row = document.createElement("tr");
          row.innerHTML = `
      <td>${c.id}</td>
      <td>${c.usuario}</td>
      <td>${c.descricao}</td>
      <td>${c.contato}</td>
      <td>${c.tipo}</td>
      <td>${c.curso}</td>
      <td>${c.nivel}</td>
    `;
          row.addEventListener("dblclick", () => mostrarCard(c));
          tabela.appendChild(row);
        });
      }

      async function carregarVagas(filtro = "") {
        const url = "http://localhost:8080/api/vagas";
        const response = await fetch(url);
        const data = await response.json();
        const tabela = document.getElementById("empresadisponiveis_table");
        tabela.innerHTML = "";

        const vagasFiltradas = filtro
          ? data.filter((v) =>
              Object.values(v).some(
                (val) => val && val.toString().toLowerCase().includes(filtro)
              )
            )
          : data;

        if (vagasFiltradas.length === 0) {
          tabela.innerHTML = `<tr><td colspan="7" style="text-align:center">Nenhuma vaga encontrada</td></tr>`;
          return;
        }

        vagasFiltradas.forEach((v) => {
          const row = document.createElement("tr");
          row.innerHTML = `
      <td>${v.id}</td>
      <td>${v.empresa}</td>
      <td>${v.descricao}</td>
      <td>${v.contato}</td>
      <td>${v.tipo}</td>
      <td>${v.curso}</td>
      <td>${v.nivel}</td>
    `;
          row.addEventListener("dblclick", () => mostrarCard(v, true));
          tabela.appendChild(row);
        });
      }

      function mostrarCard(item, isVaga = false) {
        const overlay = document.getElementById("card-overlay");
        overlay.innerHTML = `
    <div class="vaga-card">
      <h5>${isVaga ? item.empresa : item.usuario}</h5>
      <p><strong>Descrição:</strong> ${item.descricao}</p>
      <p><strong>Contato:</strong> ${item.contato}</p>
      <p><strong>Tipo:</strong> ${item.tipo}</p>
      <p><strong>Curso:</strong> ${item.curso}</p>
      <p><strong>Nível:</strong> ${item.nivel}</p>
      <img src="${
        item.foto ? "file:///" + item.foto : "imagens/semfoto.png"
      }" style="width:250px;height:250px;object-fit:cover;margin-top:10px">
      <button class="btn-fechar" onclick="fecharCard()">Fechar</button>
    </div>
  `;
        overlay.style.display = "flex";
      }

      function fecharCard() {
        const overlay = document.getElementById("card-overlay");
        overlay.style.display = "none";
        overlay.innerHTML = "";
      }
    </script>
  </body>
</html>
