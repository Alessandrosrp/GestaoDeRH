<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    />

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <title>Cadastro - Confirma√ß√£o de Conta</title>

    <!-- Script EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <style>
      body {
        background: linear-gradient(to right, #1B4965, #3E4C59, #1B4965);
        height: 100vh;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        font-family: Arial, sans-serif;
        overflow: hidden;
      }

      .background-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 10vw;
        font-weight: 700;
        color: rgba(255, 255, 255, 0.05);
        white-space: nowrap;
        font-family: 'Montserrat', sans-serif;
        z-index: 0;
        pointer-events: none;
      }

      .register-box {
        background: transparent;
        padding: 40px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        width: 100%;
        max-width: 400px;
        position: relative;
        z-index: 1;
        color: white;
      }

      .register-box h2 {
        margin-bottom: 30px;
        font-weight: bold;
        text-align: center;
        color: white;
      }

      .form-control {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
      }

      .form-control::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .form-control option {
        background-color: #1B4965;
        color: white;
      }

      .btn-custom {
        background-color: #ffffff;
        color: #1b4965;
        font-weight: bold;
      }

      .btn-custom:hover {
        background-color: #f0f0f0;
        color: #163d55;
      }

      .hidden {
        display: none;
      }
    </style>

    <script>
      // Inicializa EmailJS
      window.onload = function () {
        emailjs.init("GvIi-4wTVAijBYoYP"); // seu userID
      };

      function cadastrarUsuario(event) {
        event.preventDefault();

        const senha = document.getElementById("password").value;
        const confirmar = document.getElementById("confirm-password").value;

        if (senha !== confirmar) {
          alert("As senhas n√£o coincidem.");
          return;
        }

        const usuario = {
          tipo: document.getElementById("tipo").value,
          email: document.getElementById("email").value,
          nome: document.getElementById("nome").value,
          matricula: document.getElementById("matricula").value || null,
          senha: senha
        };

        console.log("DEBUG (FRONT CADASTRO):", usuario);

        // üîπ 1. Salvar no backend
        fetch("http://localhost:8080/cadastro", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(usuario),
        })
          .then(res => {
            if (!res.ok) throw new Error("Erro ao salvar no backend");
            return res.json();
          })
          .then(data => {
            console.log("Usu√°rio salvo:", data);

            // üîπ 2. Enviar e-mail de confirma√ß√£o
            return emailjs.send("service_r3r3cyh", "template_dbm1aqg", {
              nome: usuario.nome,
              email: usuario.email,
              matricula: usuario.matricula || "N√£o informado",
            });
          })
          .then(() => {
            alert("Conta criada com sucesso! Um e-mail de confirma√ß√£o foi enviado.");
            
            // ‚úÖ Redirecionamento para a tela de login
            window.location.href = "teladelogin.html";
          })
          .catch(err => {
            console.error("Erro:", err);
            alert("Erro ao criar conta.");
          });
      }

      // Mostrar/esconder matr√≠cula
      document.addEventListener("DOMContentLoaded", function () {
        const tipoSelect = document.getElementById("tipo");
        const matriculaGroup = document.getElementById("matricula-group");
        const matriculaInput = document.getElementById("matricula");

        tipoSelect.addEventListener("change", function () {
          if (this.value === "usuario") {
            matriculaGroup.classList.remove("hidden");
            matriculaInput.setAttribute("required", "required");
          } else {
            matriculaGroup.classList.add("hidden");
            matriculaInput.removeAttribute("required");
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="background-text">CARREIRA IDEAU</div>

    <div class="register-box">
      <h2>Cadastro</h2>
      <form onsubmit="cadastrarUsuario(event)">
        <div class="form-group">
          <label for="tipo">Tipo de usu√°rio</label>
          <select class="form-control" id="tipo" required>
            <option value="">Selecione...</option>
            <option value="usuario">Sou um usu√°rio</option>
          </select>
        </div>

        <div class="form-group">
          <label for="email">E-mail</label>
          <input type="email" class="form-control" id="email" placeholder="Digite seu e-mail" required />
        </div>

        <div class="form-group">
          <label for="nome">Nome de usu√°rio</label>
          <input type="text" class="form-control" id="nome" placeholder="Digite seu nome de usu√°rio" required />
        </div>

        <div class="form-group hidden" id="matricula-group">
          <label for="matricula">Matr√≠cula</label>
          <input type="text" class="form-control" id="matricula" placeholder="Digite sua matr√≠cula" />
        </div>

        <div class="form-group">
          <label for="password">Senha</label>
          <input type="password" class="form-control" id="password" placeholder="Digite sua senha" required />
        </div>

        <div class="form-group">
          <label for="confirm-password">Confirme a senha</label>
          <input type="password" class="form-control" id="confirm-password" placeholder="Confirme sua senha" required />
        </div>

        <button type="submit" class="btn btn-custom btn-block">Criar conta</button>
        <!-- Bot√£o Voltar -->
        <button type="button" class="btn btn-custom btn-block" onclick="history.back()">Voltar</button>
      </form>
    </div>
  </body>
</html>
